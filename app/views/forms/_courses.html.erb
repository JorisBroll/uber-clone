<script>
	init.push(function () {
		$(".select2").select2({
			allowClear: true,
			placeholder: "Sélectionner..."
		});

		$(".new_course, .edit_course").validate({
			focusInvalid: false,
			rules: {
				'course[from]': {
				  required: true
				},
				'course[to]': {
					required: true,
				},
				'course[nb_people]': {
					required: true,
				},
				'course[date_when]': {
					required: true,
				},
				'course[time_when]': {
					required: true,
				}
			}
		});

		datepickerOptions = {
			daysOfWeekDisabled: "6",
			todayHighlight: true
		};

		timepickerOptions = {
			minuteStep: 5,
			showMeridian: false
		};

		$('.date').datepicker({datepickerOptions});
		$('._time').timepicker({timepickerOptions});

	});

</script>

<div class="panel">
	<div class="panel-heading">
		<span class="panel-title">Course</span>
	</div>
	<div class="panel-body">

		<%= form_for [controller, @course] do |f| %>
		    
			<%= render 'common/error_messages', object: f.object %>

			<div class="form-group">
				<%= f.label :from, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.text_field :from, class: "form-control", :placeholder => "(Ville), (Numéro de rue) (Nom de rue)" %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :to, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.text_field :to, class: "form-control", :placeholder => "(Ville), (Numéro de rue) (Nom de rue)" %>
				</div>
			</div>

			
			<div class="form-group">
				<div class="col-sm-3">
					<button id="calculer" class="btn btn-flat btn-lg" type="button">Calculer le prix</button>
					<div id="gcompute-error-display" class="alert alert-danger" style="display:none"></div>
				</div>
				<div class="col-sm-9">
					<div id="map-canvas" style="height:360px"></div>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :computed_distance, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.text_field :computed_distance, class: "form-control",:readonly => true %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :computed_duration, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.text_field :computed_duration, class: "form-control", :readonly => true %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :computed_price, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.text_field :computed_price, class: "form-control", :readonly => true %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :nb_people, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.text_field :nb_people, class: "form-control" %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :date_when, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.text_field :date_when, class: "form-control date", :placeholder => "Date", style: "position: relative; z-index: 100;" %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :time_when, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.text_field :time_when, class: "form-control _time", :placeholder => "Heure" %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :flight_number, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.text_field :flight_number, class: "form-control", :placeholder => "Numéro"  %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :nb_luggage, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.text_field :nb_luggage, class: "form-control", :placeholder => "Nombre"  %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :notes, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.text_area :notes, class: "form-control", :placeholder => "Notes" %>
				</div>
			</div>

			<hr class="panel-wide">

			<div id="stops-group" class="form-group">
				<div class="col-sm-3">
					<p><%= f.label :stops, class: "control-label" %></p>
					<p><button id="add-stops" class="btn btn-flat btn-lg" type="button">Ajouter un arrêt</button></p>
				</div>
				<div class="col-sm-9">
					<div id="stops-list">
					<% if !@course.stops.nil? %>
						<% @course.stops.each do |o| %>
							<div class="stop-container input-group">
								<input type="text" class="form-control course_stops" value="<%= o %>" name="course[stops][]">
								<span class="input-group-addon no-border close-btn bg-danger"><i class="fa fa-close"></i></span>
							</div>
						<% end %>
						<% else %>
							<div class="stop-container input-group">
								<input type="text" class="form-control course_stops" value="" name="course[stops][]">
								<span class="input-group-addon no-border close-btn bg-danger"><i class="fa fa-close"></i></span>
							</div>
					<% end %>
					</div>
				</div>
			</div>

			<hr class="panel-wide">

			<div class="form-group">
				<%= f.label :status, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.select(:status, Course::Status_select, {}, { :class => 'select2' }) %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :promocode_id, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.select(:promocode_id, promocodes_for_select('Aucun'), {}, { :class => 'select2' }) %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :payment_by, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<% if controller == 'admin' %>
					<%= f.select(:payment_by, payment_by_admin_for_select, {}, { :class => 'select2' }) %>
					<% elsif controller == 'partner_admin' %>
					<%= f.select(:payment_by, payment_by_partner_for_select, {}, { :class => 'select2' }) %>
					<% end %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :payment_status, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.select(:payment_status, payment_status_for_select, {}, { :class => 'select2' }) %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :payment_when, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.select(:payment_when, payment_when_for_select, {}, { :class => 'select2' }) %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :user_id, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<% if controller == 'admin' %>
					<%= f.select(:user_id, users_for_select('Personne (ajouter plus tard)'), {}, { :class => 'select2' }) %>
					<% elsif controller == 'partner_admin' %>
					<%= f.select(:user_id, users_for_select('Personne (ajouter plus tard)', {:partner_id => current_partner.id}), {}, { :class => 'select2' }) %>
					<% end %>
				</div>
			</div>

			<% if controller == 'admin' %>

			<div class="form-group">
				<%= f.label :partner_id, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<%= f.select(:partner_id, partners_for_select, {}, { :class => 'select2' }) %>
				</div>
			</div>

			<% end %>

			<div class="form-group">
				<%= f.label :car_id, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
				<% if controller == 'admin' %>
					<%= f.select(:car_id, cars_for_select('Aucune'), {}, { :class => 'select2' }) %>
					<% elsif controller == 'partner_admin' %>
					<%= f.select(:car_id, cars_for_select('Aucune', {:partner_id => current_partner.id}), {}, { :class => 'select2' }) %>
					<% end %>
				</div>
			</div>

			<div class="form-group">
				<%= f.label :company_id, class: "col-sm-3 control-label" %>
				<div class="col-sm-9">
					<% if controller == 'admin' %>
					<%= f.select(:company_id, companies_for_select("Pas d'entreprise"), {}, { :class => 'select2' }) %>
					<% elsif controller == 'partner_admin' %>
					<%= f.select(:company_id, companies_for_select("Pas d'entreprise", {:partner_id => current_partner.id}), {}, { :class => 'select2' }) %>
					<% end %>
					
				</div>
			</div>

			<%= hidden_field(:user, :created_by) %>

	</div>
	<div class="panel-footer text-right">
		<a class="btn btn-flat btn-danger" href="<%= send("#{controller}_courses_path") %>">Annuler</a>
		<%= f.submit action, class: "btn btn-primary btn-flat" %>
		<% end %>
	</div>
</div>	